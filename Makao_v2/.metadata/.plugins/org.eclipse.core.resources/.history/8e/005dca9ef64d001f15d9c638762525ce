package client;


import java.awt.Dimension;
import java.awt.Graphics2D;
import java.awt.Image;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.RenderingHints;
import java.awt.image.*;
import java.io.File;
import java.util.Hashtable;

import javax.imageio.ImageIO;
import javax.swing.ImageIcon;

public class ImagesBuffer {
    private static ImagesBuffer iBuffer = null;
	private Hashtable<String,BufferedImage> buff = new Hashtable<String,BufferedImage>();
    private ImagesBuffer(){}
	
    public static ImagesBuffer getInstance() 
    {
		if (iBuffer== null) iBuffer=new ImagesBuffer();
    	// TODO Auto-generated method stub
		return iBuffer;
	}
    private BufferedImage read(String source)
    {
    	BufferedImage bimg = null;
    	ImageIcon icon = new ImageIcon(args[0]);
        Image image = icon.getImage();

        // Create empty BufferedImage, sized to Image
        bimg =new BufferedImage(image.getWidth(null),image.getHeight(null), BufferedImage.TYPE_INT_ARGB);

        // Draw Image into BufferedImage
        Graphics2D g = bimg.createGraphics();
        g.drawImage(image, 0, 0, null);
 
    	/*try {  
		        bimg = ImageIO.read(new File(source));  
		    } catch (Exception e) {  
		          e.printStackTrace();  
		    }*/
		 return bimg;
    }
	public void addEntry(String key,String source) 
	{
		BufferedImage bimg = read(source);
		buff.put(key, bimg);		
	}

	public void splitImagesFromSource(String source, int i, int j, int number) 
	{
		BufferedImage temp = read(source);
		int sX=0,sY=0;
		for (int k=0;k<number;k++)
		{	
			if ((sX+i) > temp.getWidth()){sX=0; sY+=j;}
			if ((sY+j) > temp.getHeight()) break;
			BufferedImage im = temp.getSubimage(sX, sY, i, j);
			String val = String.valueOf(k);
			buff.put(val, im);	
			sX+=i;
		}
		// TODO Auto-generated method stub		
	}
	public void resizeImage(String key,int newW, int newH)
	{
		BufferedImage img = buff.get(key);
		int w = img.getWidth();  
		int h = img.getHeight();  
		BufferedImage dimg = new BufferedImage(newW, newH, img.getType());  
		Graphics2D g = dimg.createGraphics();  
		g.setRenderingHint(RenderingHints.KEY_INTERPOLATION, RenderingHints.VALUE_INTERPOLATION_BILINEAR);  
		g.drawImage(img, 0, 0, newW, newH, 0, 0, w, h, null);  
		g.dispose();
		buff.remove(key);
		buff.put(key, dimg);
	}
	public BufferedImage getEntry(String key) 
	{
		// TODO Auto-generated method stub
		return buff.get(key);
	}

	public int size() {
		return buff.size();
	}

	public void removeEntry(String key) {
		buff.remove(key);
		
	}

}
